as.data.frame(sort(table(crimes$Crm.Cd.3), decreasing = TRUE))
as.data.frame(sort(table(crimes$Month.Occ), decreasing = TRUE))
as.data.frame(sort(table(crimes$Weekday.Occ), decreasing = TRUE))
t1 = system.time()
t1 = system.time
result = DiscoverSubgroups(crims[1:20000,], as.target("Crim", "330"), as.df = TRUE)
print(system.time - t1)
t1 = Sys.time()
result = DiscoverSubgroups(crims[1:20000,], as.target("Crim", "330"), as.df = TRUE)
print(Sys.time() - t1)
result
t1 = Sys.time()
result = DiscoverSubgroups(crims[1:20000,], as.target("Crim", "330"), as.df = TRUE)
print(Sys.time() - t1)
print(result)
crims = crimes[, c("Crm.Cd", "Crm.Cd.2",                                                # Crims
"TIME.OCC2", "Month.Occ", "Weekday.Occ", "Diff.Occ.Rep",   # Hores i dates
"AREA.NAME", "Rpt.Dist.No", "Premis.Desc",                   # Localització
"Vict.Age2", "Vict.Sex", "Vict.Descent",                   # Víctima
"Weapon.Used.Cd", "Status"                                 # Altres
)
]
colnames(crims) <- c('Crim','Crim.2',                                                   # Crims
"Hora", "Mes", "Dia.Setmana", "Dif.Oc.Rep",                        # Hores i dates
"Area", "Districte", "Lloc",                                       # Localització
"Vict.Edat", "Vict.Sexe", "Vict.Descent",                          # Víctima
"Arma", "Estat"                                                    # Altres
)
t1 = Sys.time()
result = DiscoverSubgroups(crims[1:20000,], as.target("Crim", "330"), as.df = TRUE)
print(Sys.time() - t1)
print(result)
t1 = Sys.time()
result = DiscoverSubgroups(crims[1:50000,], as.target("Crim", "330"), as.df = TRUE)
print(Sys.time() - t1)
print(result)
mostra = crims[sample(nrow(crims),20000),]
t1 = Sys.time()
result = DiscoverSubgroups(mostra[1:50000,], as.target("Crim", "330"), as.df = TRUE)
print(Sys.time() - t1)
print(result)
t1 = Sys.time()
result = DiscoverSubgroups(mostra, as.target("Crim", "330"), as.df = TRUE)
print(Sys.time() - t1)
print(result)
set.seed(777)
mostra = crims[sample(nrow(crims), 20000)]
set.seed(777)
mostra = crims[sample(nrow(crims), 20000)]
set.seed(777)
mostra = crims[sample(nrow(crims), 20000),]
t1 = Sys.time()
result = DiscoverSubgroups(mostra, as.target("Crim", "330"), as.df = TRUE)
print(Sys.time() - t1)
print(result)
crims = crimes[, c("Crm.Cd", "Crm.Cd.2",                                                # Crims
"TIME.OCC2", "Month.Occ", "Weekday.Occ", "Diff.Occ.Rep",   # Hores i dates
"AREA.NAME", "Rpt.Dist.No", "Premis.Desc",                   # Localització
"Vict.Age2", "Vict.Sex", "Vict.Descent",                   # Víctima
"Weapon.Used.Desc", "Status"                                 # Altres
)
]
crims = crimes[, c("Crm.Cd", "Crm.Cd.2",                                                # Crims
"TIME.OCC2", "Month.Occ", "Weekday.Occ", "Diff.Occ.Rep",   # Hores i dates
"AREA.NAME", "Rpt.Dist.No", "Premis.Desc",                   # Localització
"Vict.Age2", "Vict.Sex", "Vict.Descent",                   # Víctima
"Weapon.Desc", "Status"                                 # Altres
)
]
colnames(crims) <- c('Crim','Crim.2',                                                   # Crims
"Hora", "Mes", "Dia.Setmana", "Dif.Oc.Rep",                        # Hores i dates
"Area", "Districte", "Lloc",                                       # Localització
"Vict.Edat", "Vict.Sexe", "Vict.Descent",                          # Víctima
"Arma", "Estat"                                                    # Altres
)
set.seed(777)
mostra = crims[sample(nrow(crims), 20000),]
result = DiscoverSubgroups(mostra, as.target("Crim", "330"), new ("SDTaskConfig", attributes=c("Crim.2", "Arma", "TIME.OCC")), as.df = TRUE)
result = DiscoverSubgroups(mostra, as.target("Crim", "330"), new ("SDTaskConfig", attributes=c("Crim.2", "Arma", "Hora")), as.df = TRUE)
result
result = DiscoverSubgroups(mostra, as.target("Crim", "110"), new ("SDTaskConfig", attributes=c("Crim.2", "Arma", "Hora")), as.df = TRUE)
result
DiscoverSubgroups(mostra, as.target("Crim", "330"), new ("SDTaskConfig", attributes=c("Area", "Hora", "Setmana", "Mes")), as.df = TRUE)
DiscoverSubgroups(mostra, as.target("Crim", "330"), new ("SDTaskConfig", attributes=c("Area", "Hora", "Dia.Setmana", "Mes")), as.df = TRUE)
DiscoverSubgroups(mostra, as.target("Crim", "330"), new ("SDTaskConfig", attributes=c("Area", "Districte")), as.df = TRUE)
DiscoverSubgroups(mostra, as.target("Crim", "330"), new ("SDTaskConfig", attributes=c("Hora", "Dia.Setmana", "Mes")), as.df = TRUE)
DiscoverSubgroups(mostra, as.target("Crim", "330"), new ("SDTaskConfig", attributes=c("Area", "Districte", "Lloc")), as.df = TRUE)
# Convertir columnes amb un id a factors
factor_cols = c("Crm.Cd", "Crm.Cd.2", "Crm.Cd.3", "Crm.Cd.4", "Weapon.Used.Cd", "Rpt.Dist.No", "Premis.Cd")
for(f in factor_cols){
crimes[[f]] = as.factor(crimes[[f]])
}
# Agafar hores de 4 en 4 i convertir a factor
interval = 4
hores = floor(floor(crimes$TIME.OCC/100)/interval)*interval
for (h in interval:24:interval){
hores[hores == h - interval] = paste((h-interval), "-", interval)
}
crimes$TIME.OCC2 = hores
# Edat de 10 en 10
crimes$Vict.Age2 = as.factor(floor(crimes$Vict.Age/10)*10)
# Columnes amb data
data_cols = c("DATE.OCC", "Date.Rptd")
for(f in data_cols){
crimes[[f]] = strptime(crimes[[f]], format = "%m/%d/%Y %H:%M:%S %p")
}
# Mes en què s'ha produït el crim
crimes$Month.Occ = as.factor(strftime(crimes$DATE.OCC, format = "%B"))
# Dia de la setmana en què s'ha produït el crim
crimes$Weekday.Occ = as.factor(strftime(crimes$DATE.OCC, format = "%A"))
# Dies que han passat des que es comet el crim fins que es reporta
diff = as.integer(mapply(julian, crimes$Date.Rptd, crimes$DATE.OCC))
diff_c = diff
diff_c[diff > 365] = "more than 1 year"
diff_c[diff <= 365] = "1 year"
diff_c[diff <= 30] = "1 month"
diff_c[diff <= 7] = "1 week"
diff_c[diff <= 3] = "3 days"
crimes$Diff.Occ.Rep = as.factor(diff_c)
crims = crimes[, c("Crm.Cd", "Crm.Cd.2",                                                # Crims
"TIME.OCC2", "Month.Occ", "Weekday.Occ", "Diff.Occ.Rep",   # Hores i dates
"AREA.NAME", "Rpt.Dist.No", "Premis.Desc",                   # Localització
"Vict.Age2", "Vict.Sex", "Vict.Descent",                   # Víctima
"Weapon.Desc", "Status"                                 # Altres
)
]
colnames(crims) <- c('Crim','Crim.2',                                                   # Crims
"Hora", "Mes", "Dia.Setmana", "Dif.Oc.Rep",                        # Hores i dates
"Area", "Districte", "Lloc",                                       # Localització
"Vict.Edat", "Vict.Sexe", "Vict.Descent",                          # Víctima
"Arma", "Estat"                                                    # Altres
)
DiscoverSubgroups(mostra, as.target("Crim", "330"), new ("SDTaskConfig", attributes=c("Hora", "Dia.Setmana", "Mes")), as.df = TRUE)
DiscoverSubgroups(mostra, as.target("Crim", "330"), new ("SDTaskConfig", attributes=c("Hora", "Dia.Setmana", "Mes")), as.df = TRUE)
set.seed(777)
mostra = crims[sample(nrow(crims), 20000),]
DiscoverSubgroups(mostra, as.target("Crim", "330"), new ("SDTaskConfig", attributes=c("Hora", "Dia.Setmana", "Mes")), as.df = TRUE)
# Convertir columnes amb un id a factors
factor_cols = c("Crm.Cd", "Crm.Cd.2", "Crm.Cd.3", "Crm.Cd.4", "Weapon.Used.Cd", "Rpt.Dist.No", "Premis.Cd")
for(f in factor_cols){
crimes[[f]] = as.factor(crimes[[f]])
}
# Agafar hores de 4 en 4 i convertir a factor
interval = 4
hores = floor(floor(crimes$TIME.OCC/100)/interval)*interval
for (h in interval:24:interval){
hores[hores == h - interval] = paste((h-interval), "-", interval)
}
crimes$TIME.OCC2 = as.factor(hores)
# Edat de 10 en 10
crimes$Vict.Age2 = as.factor(floor(crimes$Vict.Age/10)*10)
# Columnes amb data
data_cols = c("DATE.OCC", "Date.Rptd")
for(f in data_cols){
crimes[[f]] = strptime(crimes[[f]], format = "%m/%d/%Y %H:%M:%S %p")
}
# Mes en què s'ha produït el crim
crimes$Month.Occ = as.factor(strftime(crimes$DATE.OCC, format = "%B"))
# Dia de la setmana en què s'ha produït el crim
crimes$Weekday.Occ = as.factor(strftime(crimes$DATE.OCC, format = "%A"))
# Dies que han passat des que es comet el crim fins que es reporta
diff = as.integer(mapply(julian, crimes$Date.Rptd, crimes$DATE.OCC))
diff_c = diff
diff_c[diff > 365] = "more than 1 year"
diff_c[diff <= 365] = "1 year"
diff_c[diff <= 30] = "1 month"
diff_c[diff <= 7] = "1 week"
diff_c[diff <= 3] = "3 days"
crimes$Diff.Occ.Rep = as.factor(diff_c)
crims = crimes[, c("Crm.Cd", "Crm.Cd.2",                                                # Crims
"TIME.OCC2", "Month.Occ", "Weekday.Occ", "Diff.Occ.Rep",   # Hores i dates
"AREA.NAME", "Rpt.Dist.No", "Premis.Desc",                   # Localització
"Vict.Age2", "Vict.Sex", "Vict.Descent",                   # Víctima
"Weapon.Desc", "Status"                                 # Altres
)
]
colnames(crims) <- c('Crim','Crim.2',                                                   # Crims
"Hora", "Mes", "Dia.Setmana", "Dif.Oc.Rep",                        # Hores i dates
"Area", "Districte", "Lloc",                                       # Localització
"Vict.Edat", "Vict.Sexe", "Vict.Descent",                          # Víctima
"Arma", "Estat"                                                    # Altres
)
str(crims)
head(crims)
set.seed(777)
mostra = crims[sample(nrow(crims), 20000),]
DiscoverSubgroups(mostra, as.target("Crim", "330"), as.df = TRUE)
# Convertir columnes amb un id a factors
factor_cols = c("Crm.Cd", "Crm.Cd.2", "Crm.Cd.3", "Crm.Cd.4", "Weapon.Used.Cd", "Rpt.Dist.No", "Premis.Cd")
for(f in factor_cols){
crimes[[f]] = as.factor(crimes[[f]])
}
# Agafar hores de 4 en 4 i convertir a factor
interval = 4
hores = floor(floor(crimes$TIME.OCC/100)/interval)*interval
for (h in interval:24:interval){
print(h)
hores[hores == h - interval] = paste((h-interval), "-", interval)
}
crimes$TIME.OCC2 = as.factor(hores)
# Edat de 10 en 10
crimes$Vict.Age2 = as.factor(floor(crimes$Vict.Age/10)*10)
# Columnes amb data
data_cols = c("DATE.OCC", "Date.Rptd")
for(f in data_cols){
crimes[[f]] = strptime(crimes[[f]], format = "%m/%d/%Y %H:%M:%S %p")
}
# Mes en què s'ha produït el crim
crimes$Month.Occ = as.factor(strftime(crimes$DATE.OCC, format = "%B"))
# Dia de la setmana en què s'ha produït el crim
crimes$Weekday.Occ = as.factor(strftime(crimes$DATE.OCC, format = "%A"))
# Dies que han passat des que es comet el crim fins que es reporta
diff = as.integer(mapply(julian, crimes$Date.Rptd, crimes$DATE.OCC))
# Convertir columnes amb un id a factors
factor_cols = c("Crm.Cd", "Crm.Cd.2", "Crm.Cd.3", "Crm.Cd.4", "Weapon.Used.Cd", "Rpt.Dist.No", "Premis.Cd")
for(f in factor_cols){
crimes[[f]] = as.factor(crimes[[f]])
}
# Agafar hores de 4 en 4 i convertir a factor
interval = 4
hores = floor(floor(crimes$TIME.OCC/100)/interval)*interval
for (h in interval:24:interval){
print(h)
hores[hores == h - interval] = paste((h-interval), "-", interval)
}
crimes$TIME.OCC2 = as.factor(hores)
# Edat de 10 en 10
crimes$Vict.Age2 = as.factor(floor(crimes$Vict.Age/10)*10)
# Columnes amb data
data_cols = c("DATE.OCC", "Date.Rptd")
for(f in data_cols){
crimes[[f]] = strptime(crimes[[f]], format = "%m/%d/%Y %H:%M:%S %p")
}
# Mes en què s'ha produït el crim
crimes$Month.Occ = as.factor(strftime(crimes$DATE.OCC, format = "%B"))
# Dia de la setmana en què s'ha produït el crim
crimes$Weekday.Occ = as.factor(strftime(crimes$DATE.OCC, format = "%A"))
# Dies que han passat des que es comet el crim fins que es reporta
# diff = as.integer(mapply(julian, crimes$Date.Rptd, crimes$DATE.OCC))
# diff_c = diff
# diff_c[diff > 365] = "more than 1 year"
# diff_c[diff <= 365] = "1 year"
# diff_c[diff <= 30] = "1 month"
# diff_c[diff <= 7] = "1 week"
# diff_c[diff <= 3] = "3 days"
# crimes$Diff.Occ.Rep = as.factor(diff_c)
# Convertir columnes amb un id a factors
factor_cols = c("Crm.Cd", "Crm.Cd.2", "Crm.Cd.3", "Crm.Cd.4", "Weapon.Used.Cd", "Rpt.Dist.No", "Premis.Cd")
for(f in factor_cols){
crimes[[f]] = as.factor(crimes[[f]])
}
# Agafar hores de 4 en 4 i convertir a factor
interval = 4
hores = floor(floor(crimes$TIME.OCC/100)/interval)*interval
for (h in seq(interval, 24, by=interval)){
print(h)
hores[hores == h - interval] = paste((h-interval), "-", interval)
}
crimes$TIME.OCC2 = as.factor(hores)
# Edat de 10 en 10
crimes$Vict.Age2 = as.factor(floor(crimes$Vict.Age/10)*10)
# Columnes amb data
data_cols = c("DATE.OCC", "Date.Rptd")
for(f in data_cols){
crimes[[f]] = strptime(crimes[[f]], format = "%m/%d/%Y %H:%M:%S %p")
}
# Mes en què s'ha produït el crim
crimes$Month.Occ = as.factor(strftime(crimes$DATE.OCC, format = "%B"))
# Dia de la setmana en què s'ha produït el crim
crimes$Weekday.Occ = as.factor(strftime(crimes$DATE.OCC, format = "%A"))
# Dies que han passat des que es comet el crim fins que es reporta
# diff = as.integer(mapply(julian, crimes$Date.Rptd, crimes$DATE.OCC))
# diff_c = diff
# diff_c[diff > 365] = "more than 1 year"
# diff_c[diff <= 365] = "1 year"
# diff_c[diff <= 30] = "1 month"
# diff_c[diff <= 7] = "1 week"
# diff_c[diff <= 3] = "3 days"
# crimes$Diff.Occ.Rep = as.factor(diff_c)
crimes = read.csv2("Crime_Data_from_2020_to_Present.csv", header = TRUE, sep = ",", stringsAsFactors = TRUE)
# Convertir columnes amb un id a factors
factor_cols = c("Crm.Cd", "Crm.Cd.2", "Crm.Cd.3", "Crm.Cd.4", "Weapon.Used.Cd", "Rpt.Dist.No", "Premis.Cd")
for(f in factor_cols){
crimes[[f]] = as.factor(crimes[[f]])
}
# Agafar hores de 4 en 4 i convertir a factor
interval = 4
hores = floor(floor(crimes$TIME.OCC/100)/interval)*interval
for (h in seq(interval, 24, by=interval)){
hores[hores == h - interval] = paste((h-interval), "-", interval)
}
crimes$TIME.OCC2 = as.factor(hores)
# Edat de 10 en 10
crimes$Vict.Age2 = as.factor(floor(crimes$Vict.Age/10)*10)
# Columnes amb data
data_cols = c("DATE.OCC", "Date.Rptd")
for(f in data_cols){
crimes[[f]] = strptime(crimes[[f]], format = "%m/%d/%Y %H:%M:%S %p")
}
# Mes en què s'ha produït el crim
crimes$Month.Occ = as.factor(strftime(crimes$DATE.OCC, format = "%B"))
# Dia de la setmana en què s'ha produït el crim
crimes$Weekday.Occ = as.factor(strftime(crimes$DATE.OCC, format = "%A"))
# Dies que han passat des que es comet el crim fins que es reporta
diff = as.integer(mapply(julian, crimes$Date.Rptd, crimes$DATE.OCC))
diff_c = diff
diff_c[diff > 365] = "more than 1 year"
diff_c[diff <= 365] = "1 year"
diff_c[diff <= 30] = "1 month"
diff_c[diff <= 7] = "1 week"
diff_c[diff <= 3] = "3 days"
crimes$Diff.Occ.Rep = as.factor(diff_c)
crims = crimes[, c("Crm.Cd", "Crm.Cd.2",                                                # Crims
"TIME.OCC2", "Month.Occ", "Weekday.Occ", "Diff.Occ.Rep",   # Hores i dates
"AREA.NAME", "Rpt.Dist.No", "Premis.Desc",                   # Localització
"Vict.Age2", "Vict.Sex", "Vict.Descent",                   # Víctima
"Weapon.Desc", "Status"                                 # Altres
)
]
colnames(crims) <- c('Crim','Crim.2',                                                   # Crims
"Hora", "Mes", "Dia.Setmana", "Dif.Oc.Rep",                        # Hores i dates
"Area", "Districte", "Lloc",                                       # Localització
"Vict.Edat", "Vict.Sexe", "Vict.Descent",                          # Víctima
"Arma", "Estat"                                                    # Altres
)
str(crims)
head(crims)
set.seed(777)
mostra = crims[sample(nrow(crims), 20000),]
DiscoverSubgroups(mostra, as.target("Crim", "330"), as.df = TRUE)
DiscoverSubgroups(mostra, as.target("Crim", "330"), new ("SDTaskConfig", attributes=c("Area", "Districte", "Lloc")), as.df = TRUE)
DiscoverSubgroups(mostra, as.target("Crim", "330"), new ("SDTaskConfig", attributes=c("Hora", "Dia.Setmana", "Mes")), as.df = TRUE)
# Convertir columnes amb un id a factors
factor_cols = c("Crm.Cd", "Crm.Cd.2", "Crm.Cd.3", "Crm.Cd.4", "Weapon.Used.Cd", "Rpt.Dist.No", "Premis.Cd")
for(f in factor_cols){
crimes[[f]] = as.factor(crimes[[f]])
}
# Agafar hores de 4 en 4 i convertir a factor
interval = 4
hores = floor(floor(crimes$TIME.OCC/100)/interval)*interval
for (h in seq(interval, 24, by=interval)){
hores[hores == h - interval] = paste((h-interval), "-", h)
}
crimes$TIME.OCC2 = as.factor(hores)
# Edat de 10 en 10
crimes$Vict.Age2 = as.factor(floor(crimes$Vict.Age/10)*10)
# Columnes amb data
data_cols = c("DATE.OCC", "Date.Rptd")
for(f in data_cols){
crimes[[f]] = strptime(crimes[[f]], format = "%m/%d/%Y %H:%M:%S %p")
}
# Mes en què s'ha produït el crim
crimes$Month.Occ = as.factor(strftime(crimes$DATE.OCC, format = "%B"))
# Dia de la setmana en què s'ha produït el crim
crimes$Weekday.Occ = as.factor(strftime(crimes$DATE.OCC, format = "%A"))
# Dies que han passat des que es comet el crim fins que es reporta
diff = as.integer(mapply(julian, crimes$Date.Rptd, crimes$DATE.OCC))
diff_c = diff
diff_c[diff > 365] = "more than 1 year"
diff_c[diff <= 365] = "1 year"
diff_c[diff <= 30] = "1 month"
diff_c[diff <= 7] = "1 week"
diff_c[diff <= 3] = "3 days"
crimes$Diff.Occ.Rep = as.factor(diff_c)
crims = crimes[, c("Crm.Cd", "Crm.Cd.2",                                                # Crims
"TIME.OCC2", "Month.Occ", "Weekday.Occ", "Diff.Occ.Rep",   # Hores i dates
"AREA.NAME", "Rpt.Dist.No", "Premis.Desc",                   # Localització
"Vict.Age2", "Vict.Sex", "Vict.Descent",                   # Víctima
"Weapon.Desc", "Status"                                 # Altres
)
]
colnames(crims) <- c('Crim','Crim.2',                                                   # Crims
"Hora", "Mes", "Dia.Setmana", "Dif.Oc.Rep",                        # Hores i dates
"Area", "Districte", "Lloc",                                       # Localització
"Vict.Edat", "Vict.Sexe", "Vict.Descent",                          # Víctima
"Arma", "Estat"                                                    # Altres
)
str(crims)
head(crims)
as.data.frame(sort(table(crimes$Crm.Cd.Desc), decreasing = TRUE))
as.data.frame(sort(table(crimes$Crm.Cd.2), decreasing = TRUE))
as.data.frame(sort(table(crimes$AREA.NAME), decreasing = TRUE))
set.seed(777)
mostra = crims[sample(nrow(crims), 20000),]
DiscoverSubgroups(mostra, as.target("Crim", "330"), as.df = TRUE)
DiscoverSubgroups(mostra, as.target("Crim", "330"), as.df = TRUE)
set.seed(777)
mostra = crims[sample(nrow(crims), 20000),]
DiscoverSubgroups(mostra, as.target("Crim", "330"), as.df = TRUE)
DiscoverSubgroups(mostra, as.target("Crim", "330"), new ("SDTaskConfig", attributes=c("Hora", "Dia.Setmana", "Mes")), as.df = TRUE)
crims = crimes[, c("Crm.Cd", "Crm.Cd.2",                                                # Crims
"TIME.OCC2", "Month.Occ", "Weekday.Occ", "Diff.Occ.Rep",   # Hores i dates
"AREA.NAME", "Rpt.Dist.No", "Premis.Desc",                   # Localització
"Vict.Age2", "Vict.Sex", "Vict.Descent",                   # Víctima
"Weapon.Desc", "Status"                                 # Altres
)
]
colnames(crims) <- c('Crim','Crim.2',                                                   # Crims
"Hora", "Mes", "Dia.Setmana", "Dif.Oc.Rep",                        # Hores i dates
"Area", "Districte", "Lloc",                                       # Localització
"Vict.Edat", "Vict.Sexe", "Vict.Descent",                          # Víctima
"Arma", "Estat"                                                    # Altres
)
set.seed(777)
mostra = crims[sample(nrow(crims), 20000),]
DiscoverSubgroups(mostra, as.target("Crim", "330"), as.df = TRUE)
# Convertir columnes amb un id a factors
factor_cols = c("Crm.Cd", "Crm.Cd.2", "Crm.Cd.3", "Crm.Cd.4", "Weapon.Used.Cd", "Rpt.Dist.No", "Premis.Cd")
for(f in factor_cols){
crimes[[f]] = as.factor(crimes[[f]])
}
# Agafar hores de 4 en 4 i convertir a factor
interval = 4
hores = floor(floor(crimes$TIME.OCC/100)/interval)*interval
for (h in seq(interval, 24, by=interval)){
hores[hores == h - interval] = paste((h-interval), "-", h)
}
crimes$TIME.OCC2 = as.factor(hores)
# Edat de 10 en 10
crimes$Vict.Age2 = as.factor(floor(crimes$Vict.Age/10)*10)
# Columnes amb data
data_cols = c("DATE.OCC", "Date.Rptd")
for(f in data_cols){
crimes[[f]] = strptime(crimes[[f]], format = "%m/%d/%Y %H:%M:%S %p")
}
# Mes en què s'ha produït el crim
crimes$Month.Occ = as.factor(strftime(crimes$DATE.OCC, format = "%B"))
# Dia de la setmana en què s'ha produït el crim
crimes$Weekday.Occ = as.factor(strftime(crimes$DATE.OCC, format = "%A"))
# Dies que han passat des que es comet el crim fins que es reporta
diff = as.integer(mapply(julian, crimes$Date.Rptd, crimes$DATE.OCC))
diff_c = diff
diff_c[diff > 365] = "more than 1 year"
diff_c[diff <= 365] = "1 year"
diff_c[diff <= 30] = "1 month"
diff_c[diff <= 7] = "1 week"
diff_c[diff <= 3] = "3 days"
crimes$Diff.Occ.Rep = as.factor(diff_c)
crims = crimes[, c("Crm.Cd", "Crm.Cd.2",                                                # Crims
"TIME.OCC2", "Month.Occ", "Weekday.Occ", "Diff.Occ.Rep",   # Hores i dates
"AREA.NAME", "Rpt.Dist.No", "Premis.Desc",                   # Localització
"Vict.Age2", "Vict.Sex", "Vict.Descent",                   # Víctima
"Weapon.Desc", "Status"                                 # Altres
)
]
colnames(crims) <- c('Crim','Crim.2',                                                   # Crims
"Hora", "Mes", "Dia.Setmana", "Dif.Oc.Rep",                        # Hores i dates
"Area", "Districte", "Lloc",                                       # Localització
"Vict.Edat", "Vict.Sexe", "Vict.Descent",                          # Víctima
"Arma", "Estat"                                                    # Altres
)
str(crims)
head(crims)
set.seed(777)
mostra = crims[sample(nrow(crims), 20000),]
DiscoverSubgroups(mostra, as.target("Crim", "330"), as.df = TRUE)
crimes = read.csv2("Crime_Data_from_2020_to_Present.csv", header = TRUE, sep = ",", stringsAsFactors = TRUE)
# Convertir columnes amb un id a factors
factor_cols = c("Crm.Cd", "Crm.Cd.2", "Crm.Cd.3", "Crm.Cd.4", "Weapon.Used.Cd", "Rpt.Dist.No", "Premis.Cd")
for(f in factor_cols){
crimes[[f]] = as.factor(crimes[[f]])
}
# Agafar hores de 4 en 4 i convertir a factor
interval = 4
hores = floor(floor(crimes$TIME.OCC/100)/interval)*interval
for (h in seq(interval, 24, by=interval)){
hores[hores == h - interval] = paste((h-interval), "-", h)
}
crimes$TIME.OCC2 = as.factor(hores)
# Edat de 10 en 10
crimes$Vict.Age2 = as.factor(floor(crimes$Vict.Age/10)*10)
# Columnes amb data
data_cols = c("DATE.OCC", "Date.Rptd")
for(f in data_cols){
crimes[[f]] = strptime(crimes[[f]], format = "%m/%d/%Y %H:%M:%S %p")
}
# Mes en què s'ha produït el crim
crimes$Month.Occ = as.factor(strftime(crimes$DATE.OCC, format = "%B"))
# Dia de la setmana en què s'ha produït el crim
crimes$Weekday.Occ = as.factor(strftime(crimes$DATE.OCC, format = "%A"))
# Dies que han passat des que es comet el crim fins que es reporta
diff = as.integer(mapply(julian, crimes$Date.Rptd, crimes$DATE.OCC))
diff_c = diff
diff_c[diff > 365] = "more than 1 year"
diff_c[diff <= 365] = "1 year"
diff_c[diff <= 30] = "1 month"
diff_c[diff <= 7] = "1 week"
diff_c[diff <= 3] = "3 days"
crimes$Diff.Occ.Rep = as.factor(diff_c)
crims = crimes[, c("Crm.Cd", "Crm.Cd.2",                                                # Crims
"TIME.OCC2", "Month.Occ", "Weekday.Occ", "Diff.Occ.Rep",   # Hores i dates
"AREA.NAME", "Rpt.Dist.No", "Premis.Desc",                   # Localització
"Vict.Age2", "Vict.Sex", "Vict.Descent",                   # Víctima
"Weapon.Desc", "Status"                                 # Altres
)
]
colnames(crims) <- c('Crim','Crim.2',                                                   # Crims
"Hora", "Mes", "Dia.Setmana", "Dif.Oc.Rep",                        # Hores i dates
"Area", "Districte", "Lloc",                                       # Localització
"Vict.Edat", "Vict.Sexe", "Vict.Descent",                          # Víctima
"Arma", "Estat"                                                    # Altres
)
str(crims)
head(crims)
as.data.frame(sort(table(crimes$Crm.Cd.Desc), decreasing = TRUE))
as.data.frame(sort(table(crimes$Crm.Cd.2), decreasing = TRUE))
as.data.frame(sort(table(crimes$AREA.NAME), decreasing = TRUE))
set.seed(777)
mostra = crims[sample(nrow(crims), 20000),]
DiscoverSubgroups(mostra, as.target("Crim", "330"), as.df = TRUE)
DiscoverSubgroups(mostra, as.target("Crim", "330"), new ("SDTaskConfig", attributes=c("Area", "Districte", "Lloc")), as.df = TRUE)
DiscoverSubgroups(mostra, as.target("Crim", "330"), new ("SDTaskConfig", attributes=c("Hora", "Dia.Setmana", "Mes")), as.df = TRUE)
